(()=>{var I=Object.create;var a=Object.defineProperty;var D=Object.getOwnPropertyDescriptor;var V=Object.getOwnPropertyNames;var j=Object.getPrototypeOf,$=Object.prototype.hasOwnProperty;var R=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),P=(e,t)=>{for(var o in t)a(e,o,{get:t[o],enumerable:!0})},u=(e,t,o,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of V(t))!$.call(e,n)&&n!==o&&a(e,n,{get:()=>t[n],enumerable:!(r=D(t,n))||r.enumerable});return e};var c=(e,t,o)=>(o=e!=null?I(j(e)):{},u(t||!e||!e.__esModule?a(o,"default",{value:e,enumerable:!0}):o,e)),A=e=>u(a({},"__esModule",{value:!0}),e);var s=R((X,f)=>{f.exports=shelter.solidWeb});var Q={};P(Q,{insertTimer:()=>l,onLoad:()=>z,onUnload:()=>B,settings:()=>_});var p=c(s(),1);var v=c(s(),1),d=c(s(),1);var E=(0,v.template)("<p></p>",2),{solid:{createSignal:L,onCleanup:M},plugin:{store:U}}=shelter;function h(e){let t=Math.floor(e/3600),o=Math.floor(e/60)-t*60,r=Math.floor(e-t*3600-o*60);return(t?t.toString()+":":"")+o.toString().padStart(2,"0")+":"+r.toString().padStart(2,"0")}var C=()=>{let e=()=>(Date.now()-U.joinTime)/1e3,[t,o]=L(h(e())),r=setInterval(()=>o(h(e())),1e3);return M(()=>{clearInterval(r),l()}),(()=>{let n=E.cloneNode(!0);return n.style.setProperty("display","inline"),n.style.setProperty("font-family","monospace"),(0,d.insert)(n,()=>t()+" \u2022 "),n})()};var T=c(s(),1),{plugin:{store:S},ui:{SwitchItem:q}}=shelter,_=()=>(0,T.createComponent)(q,{get value(){return S.persistTime},onChange:e=>S.persistTime=e,note:"Time resets after 10 seconds of not being in a voice channel",children:"Persist time across channel moves"});var{flux:{dispatcher:b,awaitStore:K},ui:{ReactiveRoot:N},plugin:{store:i},observeDom:k}=shelter,g='[class^="rtcConnectionStatus"] + a > div[class*="subtext"]:not(:has(.ioj4-vct))',m=!1;async function l(){if(m||!i.isInVC)return;m=!0;let e=document.querySelector(g)??await new Promise(o=>{let r=k(g,o);setTimeout(()=>{r(),o()},2e3)});if(!e){m=!1;return}let t=(0,p.createComponent)(N,{get children(){return(0,p.createComponent)(C,{})}});t.className="ioj4-vct",e.prepend(t),m=!1}var x=0;function y(){i.isInVC||(i.isInVC=!0,(!i.persistTime||x<Date.now()-1e4)&&(i.joinTime=Date.now())),l()}function w(e){e.event==="join_voice_channel"?y():e.event==="leave_voice_channel"&&(i.isInVC=!1,x=Date.now())}async function z(){(await K("VoiceStateStore")).isCurrentClientInVoiceChannel()&&y(),b.subscribe("TRACK",w)}function B(){i.isInVC=!1,b.unsubscribe("TRACK",w),document.querySelectorAll(".ioj4-vct").forEach(e=>e.remove())}return A(Q);})();

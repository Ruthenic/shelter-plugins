(()=>{var v=Object.create;var l=Object.defineProperty;var w=Object.getOwnPropertyDescriptor;var P=Object.getOwnPropertyNames;var D=Object.getPrototypeOf,L=Object.prototype.hasOwnProperty;var k=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports),O=(n,t)=>{for(var e in t)l(n,e,{get:t[e],enumerable:!0})},h=(n,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of P(t))!L.call(n,o)&&o!==e&&l(n,o,{get:()=>t[o],enumerable:!(i=w(t,o))||i.enumerable});return n};var y=(n,t,e)=>(e=n!=null?v(D(n)):{},h(t||!n||!n.__esModule?l(e,"default",{value:n,enumerable:!0}):e,n)),$=n=>h(l({},"__esModule",{value:!0}),n);var u=k((X,b)=>{b.exports=shelter.solidWeb});var K={};O(K,{channelElementQuery:()=>c,onLoad:()=>B,onUnload:()=>J});var T=y(u(),1);var g=y(u(),1),G=(0,g.template)("<div><span></span><span></span><span></span></div>",8),S=()=>G.cloneNode(!0);shelter.plugin.scoped.ui.injectCss("._indicator_1obqu_1{margin-left:4px}._indicator_1obqu_1 span{height:6px;width:6px;float:left;margin:0 1px;background-color:var(--text-normal);display:block;border-radius:50%;opacity:.3}._indicator_1obqu_1 span:nth-child(1){animation:1s ease-in 0.2s _typingAnimation_1obqu_1;animation-iteration-count:infinite}._indicator_1obqu_1 span:nth-child(2){animation:1s ease-in 0.4s _typingAnimation_1obqu_1;animation-iteration-count:infinite}._indicator_1obqu_1 span:nth-child(3){animation:1s ease-in 0.6s _typingAnimation_1obqu_1;animation-iteration-count:infinite}@keyframes _typingAnimation_1obqu_1{33.3%{opacity:1;transform:scale(1.2)}}");var a={indicator:"_indicator_1obqu_1",typingAnimation:"_typingAnimation_1obqu_1"};var{flux:{awaitStore:I},solidWeb:{render:M},util:{getFiber:F,reactFiberWalker:W}}=shelter;function E(){document.querySelectorAll(c).forEach(t=>{let e=F(t);W(e,({stateNode:r})=>r&&!(r instanceof Element),!0)?.stateNode?.forceUpdate()})}function A(n){return document.querySelector(`[data-list-item-id="channels___${n}"]`)?.parentElement?.querySelector('div[class^="children_"]')}async function d(n){A(n)?.querySelector(`.${a.indicator}`)?.remove()}function m(n){let t=A(n);if(t&&!t.querySelector(`.${a.indicator}`)){let e=document.createElement("div");e.classList.add(a.indicator),t.prepend(e),M(()=>(0,T.createComponent)(S,{}),e)}}async function _(n){let t=await I("TypingStore"),i=(await I("UserStore")).getCurrentUser().id;return Object.keys(t.getTypingUsers(n)).filter(r=>r!==i).length!==0}function C(){document.querySelectorAll(`.${a.indicator}`).forEach(n=>n.remove())}var{flux:{dispatcher:s,awaitStore:R},util:{getFiber:Y,reactFiberWalker:H},patcher:j,observeDom:Q}=shelter,c='a[data-list-item-id^="channels___"]:not([class^="mainContent"])',p=!1,q;async function x({type:n,userId:t,channelId:e}){let i=await R("UserStore");if(t!==i.getCurrentUser().id)switch(n){case"TYPING_START":return m(e);case"TYPING_STOP":case"MESSAGE_CREATE":await _(e)||d(e)}}function N(n){let t=Y(n),e=H(t,i=>!!i?.type?.render,!0);e&&(q=j.after("render",e.type,i=>{let o=i[0]["data-list-item-id"];if(!o)return;let r=o.split("___")[1];queueMicrotask(async()=>{await _(r)?m(r):d(r)})}),p=!0,E())}async function f(){let n=Q(c,t=>{p||(N(t),n(),s.unsubscribe("UPDATE_CHANNEL_LIST_DIMENSIONS",f))});setTimeout(n,1e3)}function z(){let n=document.querySelector(c);n&&N(n)}var U=["TYPING_START","TYPING_STOP","MESSAGE_CREATE"];function B(){z(),U.forEach(n=>s.subscribe(n,x)),!p&&s.subscribe("UPDATE_CHANNEL_LIST_DIMENSIONS",f)}function J(){U.forEach(n=>s.unsubscribe(n,x)),s.unsubscribe("UPDATE_CHANNEL_LIST_DIMENSIONS",f),q?.(),p=!1,C()}return $(K);})();

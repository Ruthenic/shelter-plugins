(()=>{var B=Object.create;var a=Object.defineProperty;var Q=Object.getOwnPropertyDescriptor;var W=Object.getOwnPropertyNames;var z=Object.getPrototypeOf,F=Object.prototype.hasOwnProperty;var J=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Y=(e,t)=>{for(var o in t)a(e,o,{get:t[o],enumerable:!0})},y=(e,t,o,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of W(t))!F.call(e,r)&&r!==o&&a(e,r,{get:()=>t[r],enumerable:!(n=Q(t,r))||n.enumerable});return e};var i=(e,t,o)=>(o=e!=null?B(z(e)):{},y(t||!e||!e.__esModule?a(o,"default",{value:e,enumerable:!0}):o,e)),K=e=>y(a({},"__esModule",{value:!0}),e);var s=J((de,_)=>{_.exports=shelter.solidWeb});var ue={};Y(ue,{onLoad:()=>le,onUnload:()=>pe});var M=i(s(),1);var L=i(s(),1),T=i(s(),1),V=i(s(),1),N=i(s(),1),p=i(s(),1),u=i(s(),1);var{flux:{stores:{SpotifyStore:f}}}=shelter;function v(){if(console.log(f),!f.hasConnectedAccount())throw new Error("No account found. Have you connected your Spotify account yet?");let e=f.getPlayableComputerDevices()[0];if(!e||e.length===0)throw new Error("No device found. Start Spotify and try again");return e}var X=async()=>(v().socket.handleDeviceStateChange(),new Promise(e=>setTimeout(e,2e3)));async function m(e,t,o,n,r=!1){let{device:O,socket:D}=v(),I=D.accessToken,g=new URL(`https://api.spotify.com/v1/me/player/${t}`);return g.search=new URLSearchParams({device_id:O.id,...o}).toString(),new Promise((Z,G)=>{let j={method:e,headers:{"Content-Type":"application/json",Authorization:`Bearer ${I}`},body:JSON.stringify(n)};fetch(g.toString(),j).then(async d=>{if(d.ok)return Z();d.status===401&&!r&&(console.log("Trying reauth"),shelter.ui.showToast({title:"Reauth"}),await X(),m(...arguments,!0)),G(`Error during request: ${d.status}`)})})}async function ee(e){let t=/<meta property="og:url" content="(.+?)"\/>/,o=await(await fetch(`https://shcors.uwu.network/${e}`)).text();return console.log(t.exec(o)),t.exec(o)?.[1]}async function S(e){try{e=new URL(e),e.hostname==="spotify.link"&&(e=new URL(await ee(e)));for(let[t,o]of Object.entries(apps))if(o.hostnames.includes(e.hostname)&&store.enabledApps[t])return o.protocol+e.toString()}catch{}return console.log("repalced",e),e.toString()}async function b(e){window.open(await S(e))}async function x(e){let{pathname:t}=new URL((await S(e)).toLowerCase());return/(track|album|playlist|episode|show|artist)(?:\/)([a-z0-9]+)/i.exec(t).slice(1)}async function $(e){let[t,o]=await x(e);console.log(t,o);let n=t==="track"?{uris:[`spotify:${t}:${o}`]}:{context:`spotify:${t}:${o}`};n.position_ms=0,m("PUT","play",{},n).then(console.log,console.error)}async function E(e){let[t,o]=await x(e);console.log(t),["episode","track"].includes(t)||shelter.ui.showToast({title:"This item can not be queued!"}),m("POST","queue",{uri:`spotify:${t}:${o}`}).then(()=>shelter.ui.showToast({title:"success"}),n=>{shelter.ui.showToast({title:"no success"}),console.warn(n)})}var c=i(s(),1),te=(0,c.template)('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.6438 2.15465C11.4612 2.19322 11.2874 2.28356 11.1453 2.42565L7.59106 5.97985C7.4563 6.36608 7.54272 6.81285 7.85181 7.12194C8.17065 7.44078 8.63647 7.52281 9.03101 7.36803L10.8528 5.54674V13.0223C10.8528 13.5746 11.3 14.0223 11.8528 14.0223C12.405 14.0223 12.8528 13.5746 12.8528 13.0223V5.54674L14.6746 7.36901C15.0691 7.52281 15.5344 7.44078 15.8528 7.12194C16.1624 6.81285 16.2488 6.36559 16.113 5.97887L12.5598 2.42565C12.3113 2.17711 11.9641 2.08678 11.6438 2.15465Z" fill="currentColor"></path><path d="M4.18774 8.0775C3.6355 8.0775 3.18774 8.52526 3.18774 9.0775V20.8671C3.18774 21.4193 3.6355 21.8671 4.18774 21.8671H19.8123C20.3645 21.8671 20.8123 21.4193 20.8123 20.8671V9.0775C20.8123 8.52526 20.3645 8.0775 19.8123 8.0775H16.8743V10.0775H18.8123V19.8671H5.18774V10.0775H6.83032V8.0775H4.18774Z" fill="currentColor"></path></svg>',6),oe=(0,c.template)('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.02637 1.04321H6.02637V4.04321H9.02637V6.04321H6.02637V9.04321H4.02637V6.04321H1.02637V4.04321H4.02637V1.04321Z" fill="currentColor"></path><path d="M12.0776 5.53198C12.0493 5.76099 12.0103 5.98657 11.9604 6.20825H19.1411C19.7939 6.20825 20.3237 6.73804 20.3237 7.39087C20.3237 8.0437 19.7939 8.57349 19.1411 8.57349H10.9424C10.48 9.26099 9.89844 9.86206 9.22754 10.3474C8.92041 10.5696 8.59473 10.7673 8.25293 10.9382H19.4263C21.3853 10.9382 22.9736 9.34985 22.9736 7.39087C22.9736 5.43188 21.3853 3.84351 19.4263 3.84351H12.0815C12.1133 4.11499 12.1299 4.39136 12.1299 4.67163C12.1299 4.96265 12.1123 5.24976 12.0776 5.53198Z" fill="currentColor"></path><path d="M22.0928 14.8972H4.05469V17.262H22.0928V14.8972Z" fill="currentColor"></path><path d="M4.05469 20.592H22.0928V22.9568H4.05469V20.592Z" fill="currentColor"></path></svg>',10),ne=(0,c.template)('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 24C18.6274 24 24 18.6274 24 12C24 5.37258 18.6274 0 12 0C5.37258 0 0 5.37258 0 12C0 18.6274 5.37258 24 12 24ZM9.04596 8.19684V15.8123C9.04596 16.1973 9.4628 16.4378 9.79614 16.2452L16.3167 12.477C16.6481 12.2855 16.6502 11.8079 16.3206 11.6134L9.80004 7.76621C9.46673 7.56955 9.04596 7.80984 9.04596 8.19684Z" fill="currentColor"></path></svg>',4),H=()=>te.cloneNode(!0),k=()=>oe.cloneNode(!0),A=()=>ne.cloneNode(!0);shelter.plugin.scoped.ui.injectCss("._wrapper_1p0v0_1{display:inline-block;height:20px;border-radius:5px;padding:0 3px;background:var(--background-secondary)}._container_1p0v0_1{margin:0 2px 0 6px;display:inline-flex;gap:10px;vertical-align:bottom}._container_1p0v0_1>button{background-color:rgba(0,0,0,0);color:var(--interactive-active);transition:opacity 250ms;padding:0;height:20px}._container_1p0v0_1>button:hover{color:var(--interactive-hover)}");var l={wrapper:"_wrapper_1p0v0_1",container:"_container_1p0v0_1"};var re=(0,L.template)('<div><button title="Open in Spotify"></button><button title="Add to queue"></button><button title="Play in Spotify"></button></div>',8),{plugin:{store:we}}=shelter;function R({url:e}){return(()=>{let t=re.cloneNode(!0),o=t.firstChild,n=o.nextSibling,r=n.nextSibling;return o.$$click=()=>b(e),(0,p.insert)(o,(0,u.createComponent)(H,{})),n.$$click=()=>E(e),(0,p.insert)(n,(0,u.createComponent)(k,{})),r.$$click=()=>$(e),(0,p.insert)(r,(0,u.createComponent)(A,{})),(0,N.effect)(()=>(0,V.className)(t,l.container)),t})()}(0,T.delegateEvents)(["click"]);var{plugin:{store:C},flux:{dispatcher:h,awaitStore:se},observeDom:ie}=shelter,ae='a:is([href^="https://open.spotify.com/"], [href^="https://spotify.link/"]):not([data-ioj4_pos])';function ce(e){if(e.dataset.ioj4_pos)return;let t=e.parentElement,o=document.createElement("div");o.classList.add(l.wrapper),t.replaceChild(o,e),o.appendChild(e),e.dataset.ioj4_pos=!0,shelter.solidWeb.render(()=>(0,M.createComponent)(R,{get url(){return e.href}}),o)}function w(){let e=ie(ae,t=>{queueMicrotask(()=>ce(t)),e()});setTimeout(e,500)}async function P({channel_id:e}){let t=await se("SelectedChannelStore");e===t.getCurrentlySelectedChannelId()&&w()}var U=["MESSAGE_CREATE","MESSAGE_UPDATE"],q=["CHANNEL_SELECT","UPDATE_CHANNEL_DIMENSIONS","SEARCH_FINISH"];function le(){C.showOpen??=!0,C.showQueue??=!0,C.showPlay??=!0,q.forEach(e=>h.subscribe(e,w)),U.forEach(e=>h.subscribe(e,P))}function pe(){q.forEach(e=>h.unsubscribe(e,w)),U.forEach(e=>h.unsubscribe(e,P))}return K(ue);})();

(()=>{var U=Object.create;var f=Object.defineProperty;var Z=Object.getOwnPropertyDescriptor;var j=Object.getOwnPropertyNames;var D=Object.getPrototypeOf,q=Object.prototype.hasOwnProperty;var K=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Q=(e,t)=>{for(var n in t)f(e,n,{get:t[n],enumerable:!0})},v=(e,t,n,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of j(t))!q.call(e,s)&&s!==n&&f(e,s,{get:()=>t[s],enumerable:!(o=Z(t,s))||o.enumerable});return e};var a=(e,t,n)=>(n=e!=null?U(D(e)):{},v(t||!e||!e.__esModule?f(n,"default",{value:e,enumerable:!0}):n,e)),z=e=>v(f({},"__esModule",{value:!0}),e);var r=K((me,$)=>{$.exports=shelter.solidWeb});var fe={};Q(fe,{onLoad:()=>he,onUnload:()=>de});var I=a(r());var i=a(r()),k=a(r()),_=a(r()),p=a(r()),h=a(r()),u=a(r()),m=a(r());var{flux:{dispatcher:{dispatch:S}}}=shelter,T=(e,t)=>window.open(`spotify:${e}:${t}`),Y="https://api.spotify.com/v1/me/player",x=()=>Object.values(shelter.flux.stores.SpotifyStore.__getLocalVars().accounts)[0],F=async()=>{return x().handleDeviceStateChange(),new Promise(e=>setTimeout(e,1e3));S({type:"SPOTIFY_ACCOUNT_ACCESS_TOKEN_REVOKE",accountId:currentAccountId}),accounts[currentAccountId].accessToken=newAccessToken.body.access_token,S({type:"SPOTIFY_ACCOUNT_ACCESS_TOKEN",accountId:currentAccountId,accessToken:newAccessToken.body.access_token})},E=()=>{let e=x().accessToken;if(e)return e;shelter.util.log("No Spotify Token","error"),shelter.ui.showToast({title:"No Spotify Token",content:"uhoh"})},N=async(e,t,n)=>{let o=Y+t;return new Promise((s,d)=>{let c={method:e,headers:{"Content-Type":"application/json",Authorization:`Bearer ${E()}`},body:n};fetch(o,c).then(async y=>{if(console.log(y),y.ok){s();return}if(y.status===401){await F(),c.headers.Authorization=`Bearer ${E()}`,fetch(o,c).then(G=>{G.ok&&s(),d()});return}d()})})},V=(e,t)=>{N("PUT",`/play?device_id=${Object.values(shelter.flux.stores.SpotifyStore.__getLocalVars().playerDevices)[0][0].id}`,JSON.stringify({uris:[`spotify:${e}:${t}`]})).then(()=>shelter.ui.showToast({title:"success"}),()=>shelter.ui.showToast({title:"no success"}))},A=(e,t)=>{N("POST",`/queue?uri=spotify:${e}:${t}&device_id=${Object.values(shelter.flux.stores.SpotifyStore.__getLocalVars().playerDevices)[0][0].id}`).then(()=>shelter.ui.showToast({title:"success"}),()=>shelter.ui.showToast({title:"no success"}))};var H="._button_622u1_1{background-color:rgba(0,0,0,0);color:var(--interactive-active);transition:opacity 250ms;padding:0;height:20px}._button_622u1_1:hover{color:var(--interactive-hover)}._wrapper_622u1_1{display:inline-block;height:20px;border-radius:5px;padding:0 3px;background:var(--background-secondary)}._container_622u1_1{margin:0 2px 0 6px;display:inline-flex;gap:10px;vertical-align:bottom}",l={button:"_button_622u1_1",wrapper:"_wrapper_622u1_1",container:"_container_622u1_1"};var W=(0,i.template)('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.6438 2.15465C11.4612 2.19322 11.2874 2.28356 11.1453 2.42565L7.59106 5.97985C7.4563 6.36608 7.54272 6.81285 7.85181 7.12194C8.17065 7.44078 8.63647 7.52281 9.03101 7.36803L10.8528 5.54674V13.0223C10.8528 13.5746 11.3 14.0223 11.8528 14.0223C12.405 14.0223 12.8528 13.5746 12.8528 13.0223V5.54674L14.6746 7.36901C15.0691 7.52281 15.5344 7.44078 15.8528 7.12194C16.1624 6.81285 16.2488 6.36559 16.113 5.97887L12.5598 2.42565C12.3113 2.17711 11.9641 2.08678 11.6438 2.15465Z" fill="currentColor"></path><path d="M4.18774 8.0775C3.6355 8.0775 3.18774 8.52526 3.18774 9.0775V20.8671C3.18774 21.4193 3.6355 21.8671 4.18774 21.8671H19.8123C20.3645 21.8671 20.8123 21.4193 20.8123 20.8671V9.0775C20.8123 8.52526 20.3645 8.0775 19.8123 8.0775H16.8743V10.0775H18.8123V19.8671H5.18774V10.0775H6.83032V8.0775H4.18774Z" fill="currentColor"></path></svg>',6),J=(0,i.template)('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.02637 1.04321H6.02637V4.04321H9.02637V6.04321H6.02637V9.04321H4.02637V6.04321H1.02637V4.04321H4.02637V1.04321Z" fill="currentColor"></path><path d="M12.0776 5.53198C12.0493 5.76099 12.0103 5.98657 11.9604 6.20825H19.1411C19.7939 6.20825 20.3237 6.73804 20.3237 7.39087C20.3237 8.0437 19.7939 8.57349 19.1411 8.57349H10.9424C10.48 9.26099 9.89844 9.86206 9.22754 10.3474C8.92041 10.5696 8.59473 10.7673 8.25293 10.9382H19.4263C21.3853 10.9382 22.9736 9.34985 22.9736 7.39087C22.9736 5.43188 21.3853 3.84351 19.4263 3.84351H12.0815C12.1133 4.11499 12.1299 4.39136 12.1299 4.67163C12.1299 4.96265 12.1123 5.24976 12.0776 5.53198Z" fill="currentColor"></path><path d="M22.0928 14.8972H4.05469V17.262H22.0928V14.8972Z" fill="currentColor"></path><path d="M4.05469 20.592H22.0928V22.9568H4.05469V20.592Z" fill="currentColor"></path></svg>',10),X=(0,i.template)('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 24C18.6274 24 24 18.6274 24 12C24 5.37258 18.6274 0 12 0C5.37258 0 0 5.37258 0 12C0 18.6274 5.37258 24 12 24ZM9.04596 8.19684V15.8123C9.04596 16.1973 9.4628 16.4378 9.79614 16.2452L16.3167 12.477C16.6481 12.2855 16.6502 11.8079 16.3206 11.6134L9.80004 7.76621C9.46673 7.56955 9.04596 7.80984 9.04596 8.19684Z" fill="currentColor"></path></svg>',4),ee=(0,i.template)("<div></div>",2),te=(0,i.template)('<button aria-label="Open in Spotify"></button>',2),oe=(0,i.template)('<button aria-label="Queue in Spotify"></button>',2),ne=(0,i.template)('<button aria-label="Play on Spotify"></button>',2),{plugin:{store:g}}=shelter,se=()=>W.cloneNode(!0),re=()=>J.cloneNode(!0),ce=()=>X.cloneNode(!0);function O(e){return(()=>{let t=ee.cloneNode(!0);return(0,u.insert)(t,(()=>{let n=(0,m.memo)(()=>!!g.showOpen);return()=>n()&&(()=>{let o=te.cloneNode(!0);return o.$$click=()=>T(e.type,e.id),(0,u.insert)(o,(0,_.createComponent)(se,{})),(0,h.effect)(()=>(0,p.className)(o,l.button)),o})()})(),null),(0,u.insert)(t,(()=>{let n=(0,m.memo)(()=>!!g.showQueue);return()=>n()&&(()=>{let o=oe.cloneNode(!0);return o.$$click=()=>A(e.type,e.id),(0,u.insert)(o,(0,_.createComponent)(re,{})),(0,h.effect)(()=>(0,p.className)(o,l.button)),o})()})(),null),(0,u.insert)(t,(()=>{let n=(0,m.memo)(()=>!!g.showPlay);return()=>n()&&(()=>{let o=ne.cloneNode(!0);return o.$$click=()=>V(e.type,e.id),(0,u.insert)(o,(0,_.createComponent)(ce,{})),(0,h.effect)(()=>(0,p.className)(o,l.button)),o})()})(),null),(0,h.effect)(()=>(0,p.className)(t,l.container)),t})()}(0,k.delegateEvents)(["click"]);var{plugin:{store:b},flux:{dispatcher:C,stores:{SelectedChannelStore:ae}},ui:{injectCss:ie},observeDom:le}=shelter,L='main[class^="chatContent"] a[href*="://open.spotify.com"]',ue=/(?:https?:\/\/open.spotify.com\/)(track|album|playlist)(?:\/)([a-z0-9]*)/i;function pe(){document.querySelectorAll(L).forEach(t=>{if(t?.dataset?.ioj4_pos)return;let n=t.href.match(ue)??[];if(n.length<3)return;let[,o,s]=n,d=t.parentNode,c=document.createElement("div");c.classList.add(l.wrapper),d.replaceChild(c,t),c.appendChild(t),t.dataset.ioj4_pos=!0,shelter.solidWeb.render(()=>(0,I.createComponent)(O,{type:o,id:s}),c)})}function w(){let e=le(L,()=>{e(),queueMicrotask(pe)});setTimeout(e,500)}function M(e){e.message.channel_id===ae.getCurrentlySelectedChannelId()&&w()}var P=["MESSAGE_CREATE","MESSAGE_UPDATE"],R=["CHANNEL_SELECT","UPDATE_CHANNEL_DIMENSIONS"],B;function he(){b.showOpen??=!0,b.showQueue??=!0,b.showPlay??=!0,B=ie(H),R.forEach(e=>C.subscribe(e,w)),P.forEach(e=>C.subscribe(e,M))}function de(){B(),R.forEach(e=>C.unsubscribe(e,w)),P.forEach(e=>C.unsubscribe(e,M))}return z(fe);})();

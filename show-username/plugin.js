(()=>{var O=Object.create;var s=Object.defineProperty;var T=Object.getOwnPropertyDescriptor;var L=Object.getOwnPropertyNames;var k=Object.getPrototypeOf,w=Object.prototype.hasOwnProperty;var G=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),P=(e,t)=>{for(var n in t)s(e,n,{get:t[n],enumerable:!0})},p=(e,t,n,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of L(t))!w.call(e,r)&&r!==n&&s(e,r,{get:()=>t[r],enumerable:!(o=T(t,r))||o.enumerable});return e};var u=(e,t,n)=>(n=e!=null?O(k(e)):{},p(t||!e||!e.__esModule?s(n,"default",{value:e,enumerable:!0}):n,e)),$=e=>p(s({},"__esModule",{value:!0}),e);var a=G((J,E)=>{E.exports=shelter.solidWeb});var Q={};P(Q,{forceAddUsernames:()=>c,onLoad:()=>H,onUnload:()=>W,settings:()=>g});var h=u(a(),1),_=u(a(),1);var f=u(a(),1);var{plugin:{store:S},ui:{SwitchItem:v}}=shelter,g=()=>(0,f.createComponent)(v,{get value(){return S.usernamesOnly},onChange:e=>{S.usernamesOnly=e,c()},children:"Only display usernames"});var F=(0,h.template)('<span style="font-weight: 600;border-radius: 5px;padding: 0 3px;background: var(--background-secondary);" class="ioj4-su"></span>',2),{plugin:{store:b},flux:{dispatcher:A,awaitStore:i},util:{getFiber:j,reactFiberWalker:q},observeDom:B}=shelter,y='[id^="message-username-"] > [class^="username"]';function c(){for(let e of document.querySelectorAll(y))C(e,!0)}async function C(e,t=!1){if(e.querySelector(".ioj4-su")&&!t)return;let n=q(j(e),"message",!0)?.pendingProps?.message;if(!n||!n?.author)return;let o=await i("ChannelStore"),r=await i("GuildMemberStore"),D=await i("RelationshipStore"),{username:R,id:l}=n.author,{type:I,guild_id:M}=o.getChannel(n?.channel_id),d=I?D.getNickname(l):r.getNick(M,l),Y="font-weight: 600;border-radius: 5px;padding: 0 3px;background: var(--background-secondary);",N=(()=>{let m=F.cloneNode(!0);return(0,_.insert)(m,R),m})();e.textContent=d&&!b.usernamesOnly?` ${d}`:"",e.prepend(N)}async function U(e){let t=await i("SelectedChannelStore");if(e.type==="MESSAGE_CREATE"&&e.channelId!==t.getChannelId())return;let n=B(y,o=>{n(),C(o)});setTimeout(n,500)}var x=["MESSAGE_CREATE","CHANNEL_SELECT","LOAD_MESSAGES_SUCCESS","UPDATE_CHANNEL_DIMENSIONS","GUILD_MEMBER_UPDATE","USER_NOTE_LOADED","GUILD_MEMBER_PROFILE_UPDATE","USER_UPDATE"];function H(){b.usernamesOnly??=!1,c();for(let e of x)A.subscribe(e,U)}function W(){for(let e of x)A.unsubscribe(e,U)}return $(Q);})();

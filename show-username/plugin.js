(()=>{var N=Object.create;var o=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var k=Object.getPrototypeOf,L=Object.prototype.hasOwnProperty;var w=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),G=(e,t)=>{for(var n in t)o(e,n,{get:t[n],enumerable:!0})},p=(e,t,n,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of T(t))!L.call(e,r)&&r!==n&&o(e,r,{get:()=>t[r],enumerable:!(s=R(t,r))||s.enumerable});return e};var u=(e,t,n)=>(n=e!=null?N(k(e)):{},p(t||!e||!e.__esModule?o(n,"default",{value:e,enumerable:!0}):n,e)),P=e=>p(o({},"__esModule",{value:!0}),e);var a=w((K,E)=>{E.exports=shelter.solidWeb});var W={};G(W,{forceAddUsernames:()=>i,onLoad:()=>B,onUnload:()=>H,settings:()=>g});var h=u(a(),1),_=u(a(),1);var f=u(a(),1);var{plugin:{store:S},ui:{SwitchItem:$}}=shelter,g=()=>(0,f.createComponent)($,{get value(){return S.usernamesOnly},onChange:e=>{S.usernamesOnly=e,i()},children:"Only display usernames"});var v=(0,h.template)('<span style="font-weight: 600;border-radius: 5px;padding: 0 3px;background: var(--background-secondary);" class="ioj4-su"></span>',2),{plugin:{store:b},flux:{dispatcher:A,awaitStore:c},util:{getFiber:q,reactFiberWalker:F},observeDom:j}=shelter;function i(){for(let e of document.querySelectorAll("[id^=message-username-] > [class^=username_]"))C(e,!0)}async function C(e,t=!1){if(e.querySelector(".ioj4-su")&&!t)return;let n=F(q(e),"message",!0)?.pendingProps?.message;if(!n||!n?.author)return;let s=await c("ChannelStore"),{username:r,id:l}=n.author,{type:x,guild_id:D}=s.getChannel(n?.channel_id),I=await c("GuildMemberStore"),M=await c("RelationshipStore"),d=x?M.getNickname(l):I.getNick(D,l),z="font-weight: 600;border-radius: 5px;padding: 0 3px;background: var(--background-secondary);",O=(()=>{let m=v.cloneNode(!0);return(0,_.insert)(m,r),m})();e.textContent=d&&!b.usernamesOnly?` ${d}`:"",e.prepend(O)}async function y(e){let t=await c("SelectedChannelStore");if(e.type==="MESSAGE_CREATE"&&e.channelId!==t.getChannelId())return;let n=j("[id^=message-username-] > [class^=username-]",s=>{n(),queueMicrotask(()=>C(s))});setTimeout(n,500)}var U=["MESSAGE_CREATE","CHANNEL_SELECT","LOAD_MESSAGES_SUCCESS","UPDATE_CHANNEL_DIMENSIONS","GUILD_MEMBER_UPDATE","USER_NOTE_LOADED","GUILD_MEMBER_PROFILE_UPDATE","USER_UPDATE"];function B(){b.usernamesOnly??=!1,i();for(let e of U)A.subscribe(e,y)}function H(){for(let e of U)A.unsubscribe(e,y)}return P(W);})();

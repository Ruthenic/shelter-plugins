(()=>{var x=Object.create;var s=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var _=Object.getOwnPropertyNames;var N=Object.getPrototypeOf,A=Object.prototype.hasOwnProperty;var I=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),O=(e,t)=>{for(var n in t)s(e,n,{get:t[n],enumerable:!0})},l=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of _(t))!A.call(e,o)&&o!==n&&s(e,o,{get:()=>t[o],enumerable:!(r=y(t,o))||r.enumerable});return e};var U=(e,t,n)=>(n=e!=null?x(N(e)):{},l(t||!e||!e.__esModule?s(n,"default",{value:e,enumerable:!0}):n,e)),k=e=>l(s({},"__esModule",{value:!0}),e);var m=I((K,d)=>{d.exports=shelter.solidWeb});var F={};O(F,{addUsernames:()=>a,onLoad:()=>q,onUnload:()=>w,settings:()=>g});var f=U(m());var{plugin:{store:p},ui:{SwitchItem:D}}=shelter,g=()=>(0,f.createComponent)(D,{get value(){return p.usernameOnly},onChange:e=>{p.usernameOnly=e,a(!0)},children:"Display the username only"});var{plugin:{store:u},flux:{dispatcher:h,stores:{GuildMemberStore:G,ChannelStore:L,RelationshipStore:M}},util:{getFiber:T,reactFiberWalker:v},observeDom:R}=shelter;function a(e){for(let t of document.querySelectorAll("[id^=message-username-]")){if(t?.dataset?.YSINK_SU&&!e)continue;t.dataset.YSINK_SU=!0;let n=v(T(t),"message",!0).pendingProps?.message,r=n.author?.username,o=n?.author?.id,{type:C,guild_id:b}=L.getChannel(n?.channel_id),c=C?M.getNickname(o):G.getNick(b,o);if(!r)continue;let i=document.createElement("span");i.textContent=r,i.style="font-weight: 600;border-radius: 5px;padding-left: 3px;padding-right: 3px;background: var(--background-secondary);",t.firstElementChild.textContent=c&&!u.usernameOnly?" "+c:"",t.firstElementChild.prepend(i)}}var S=["MESSAGE_CREATE","CHANNEL_SELECT","LOAD_MESSAGES_SUCCESS","UPDATE_CHANNEL_DIMENSIONS"];function E(){let e=R("[id^=message-username-]",()=>{e(),queueMicrotask(a)});setTimeout(e,500)}function q(){u.usernameOnly=u.usernameOnly??!1;for(let e of S)h.subscribe(e,E)}function w(){for(let e of S)h.unsubscribe(e,E)}return k(F);})();
